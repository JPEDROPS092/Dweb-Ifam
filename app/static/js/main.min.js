const IFAM=window.IFAM||{};IFAM.init=function(){IFAM.ui&&IFAM.ui.init();const e=document.querySelectorAll('form[data-validate="true"]');e.forEach(e=>{IFAM.validation&&e.id&&IFAM.validation.initFormValidation(e.id)});const t=document.querySelectorAll('form[data-ajax="true"]');t.forEach(e=>{IFAM.initAjaxForm(e)}),IFAM.initDateTimePickers(),"undefined"!=typeof bootstrap&&(document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(e=>{new bootstrap.Tooltip(e)}),document.querySelectorAll('[data-bs-toggle="popover"]').forEach(e=>{new bootstrap.Popover(e)}))},IFAM.initAjaxForm=function(e){e.addEventListener("submit",function(t){t.preventDefault();if(IFAM.validation&&!IFAM.validation.validateForm(e))return!1;const a=new FormData(e),n=e.querySelector('button[type="submit"]');n&&n.id&&IFAM.ui&&IFAM.ui.formButton?IFAM.ui.formButton.setLoading(n.id):n&&(n.setAttribute("disabled","disabled"),n.innerHTML='<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Processando...'),IFAM.ui&&IFAM.ui.loadingOverlay&&IFAM.ui.loadingOverlay.show(),fetch(e.action,{method:e.method||"POST",body:a,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(e=>{const t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json().then(t=>({status:e.status,data:t})):e.text().then(t=>({status:e.status,text:t}))}).then(t=>{if(IFAM.ui&&IFAM.ui.loadingOverlay&&IFAM.ui.loadingOverlay.hide(),n&&n.id&&IFAM.ui&&IFAM.ui.formButton?IFAM.ui.formButton.resetLoading(n.id):n&&(n.removeAttribute("disabled"),n.innerHTML="Enviar"),t.status>=200&&t.status<300){if(t.data){if(t.data.redirect)window.location.href=t.data.redirect;else if(t.data.message){IFAM.ui&&IFAM.ui.toast?IFAM.ui.toast.show(t.data.message,"success"):alert(t.data.message),t.data.resetForm&&e.reset();const a=e.getAttribute("data-success-callback");a&&"function"==typeof window[a]&&window[a](t.data)}}else if(t.text){const a=e.getAttribute("data-target");if(a){const e=document.getElementById(a);e&&(e.innerHTML=t.text)}else IFAM.ui&&IFAM.ui.toast&&IFAM.ui.toast.show("Operação realizada com sucesso","success")}}else if(t.data&&t.data.errors)Object.keys(t.data.errors).forEach(t=>{const a=e.querySelector(`[name="${t}"]`);if(a){a.classList.add("is-invalid");let e=a.nextElementSibling;e&&e.classList.contains("invalid-feedback")||(e=document.createElement("div"),e.className="invalid-feedback",a.parentNode.insertBefore(e,a.nextSibling)),e.textContent=t.data.errors[t][0]}});else if(t.data&&t.data.message)IFAM.ui&&IFAM.ui.toast?IFAM.ui.toast.show(t.data.message,"error"):alert(t.data.message);else{IFAM.ui&&IFAM.ui.toast?IFAM.ui.toast.show("Ocorreu um erro ao processar a solicitação. Por favor, tente novamente.","error"):alert("Ocorreu um erro ao processar a solicitação. Por favor, tente novamente.")}}).catch(e=>{IFAM.ui&&IFAM.ui.loadingOverlay&&IFAM.ui.loadingOverlay.hide(),n&&n.id&&IFAM.ui&&IFAM.ui.formButton?IFAM.ui.formButton.resetLoading(n.id):n&&(n.removeAttribute("disabled"),n.innerHTML="Enviar"),IFAM.ui&&IFAM.ui.toast?IFAM.ui.toast.show("Ocorreu um erro ao processar a solicitação. Por favor, tente novamente.","error"):alert("Ocorreu um erro ao processar a solicitação. Por favor, tente novamente."),console.error("AJAX request error:",e)})})},IFAM.initDateTimePickers=function(){document.querySelectorAll('input[type="date"]').forEach(e=>{if(!e.hasAttribute("min")&&!e.hasAttribute("data-no-min")){const t=(new Date).toISOString().split("T")[0];e.setAttribute("min",t)}}),document.querySelectorAll('input[type="time"]').forEach(e=>{e.hasAttribute("min")||e.hasAttribute("data-no-min")||e.setAttribute("min","08:00"),e.hasAttribute("max")||e.hasAttribute("data-no-max")||e.setAttribute("max","22:00")})},document.addEventListener("DOMContentLoaded",function(){IFAM.init()}),window.IFAM=IFAM;
