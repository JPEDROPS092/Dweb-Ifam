# SalasTech - Sistema de Migrações de Banco de Dados

Este diretório contém os arquivos de configuração e scripts de migração do banco de dados do SalasTech, utilizando Alembic.

## Estrutura

- `alembic.ini`: Arquivo de configuração principal do Alembic
- `env.py`: Configuração do ambiente de execução do Alembic
- `script.py.mako`: Template para geração de novos scripts de migração
- `versions/`: Diretório contendo os scripts de migração
- `migration_manager.py`: Script avançado para gerenciamento de migrações
- `migrate.py`: Script simplificado para comandos comuns (wrapper)
- `migration_config.py`: Configurações específicas do migration manager
- `migration_recovery.py`: Ferramentas para recuperação de migrações falhas

## Comandos Rápidos

Para operações do dia a dia, use o script `migrate.py`:

```bash
# Aplicar todas as migrações pendentes
python migrate.py migrate

# Criar uma nova migração 
python migrate.py new "Descrição da migração"

# Voltar uma migração
python migrate.py rollback

# Verificar status das migrações
python migrate.py status

# Fazer backup do banco de dados
python migrate.py backup

# Reset completo (cuidado!)
python migrate.py reset
```

## Comandos Avançados

Para comandos mais avançados, use o `migration_manager.py` diretamente:

```bash
# Ver ajuda completa
python migration_manager.py --help

# Criar migração com autogeneração
python migration_manager.py revision --autogenerate -m "Descrição da migração"

# Listar histórico de migrações
python migration_manager.py history

# Aplicar migrações até uma versão específica
python migration_manager.py upgrade <revision_id>

# Voltar migrações até uma versão específica
python migration_manager.py downgrade <revision_id>

# Verificar integridade do banco
python migration_manager.py check
```

## Boas Práticas

1. Sempre faça backup antes de operações importantes
2. Verifique migrações autogenerated antes de aplicá-las
3. Mantenha o histórico de migrações limpo e organizado
4. Use mensagens descritivas ao criar novas migrações
5. Teste migrações em ambiente de desenvolvimento antes da produção

## Recuperação de Erros

Se ocorrer algum problema durante a migração, use o `migration_recovery.py`:

```bash
# Restaurar banco a partir do último backup
python migration_recovery.py restore

# Corrigir estado inconsistente do alembic
python migration_recovery.py fix-state
```
